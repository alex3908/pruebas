<% @folder.clients.each_with_index do |client, index| %>
  <%= render partial: "quotes/new_format/amortization_cover_for_pdf", locals: { name: @show_table ? "TABLA DE AMORTIZACIÓN" : "CARÁTULA DE AMORTIZACIÓN",
                                                                                representative_name: nil,
                                                                                representative_email: nil,
                                                                                user_name: @folder.user.label,
                                                                                user_email: @folder.user.email,
                                                                                related_index: index,
                                                                                clients: [client],
                                                                                clients_count: @folder.clients.length,
                                                                                date: Time.zone.now.strftime("%Y/%m/%d"),
                                                                                folio: @folder.id,
                                                                                total_payments: @folder.payment_scheme.total_payments,
                                                                                project_name: @folder.project.name,
                                                                                stage_name: @folder.stage.full_name("/"),
                                                                                lot_name: @folder.lot.name,
                                                                                lot_area: @folder.lot.area,
                                                                                show_price: @folder.stage.show_price,
                                                                                total_with_discount: @folder.total_sale,
                                                                                initial_payment: @folder.payment_scheme.initial_payment,
                                                                                down_payment: @folder.payment_scheme.initial_payment + @folder.payment_scheme.down_payment,
                                                                                lock_payment: @folder.payment_scheme.initial_payment,
                                                                                complement_payment: @folder.payment_scheme.complement_payment,
                                                                                down_payment_finance: @folder.payment_scheme.down_payment_finance,
                                                                                down_payment_monthly_payments: @folder.first_down_payment&.total,
                                                                                down_payment_percentage: @quotation.down_payment_percentage,
                                                                                min_down_payment: @quotation.total_with_discount * @folder.stage.credit_scheme.get_min_down_payment(0.01),
                                                                                first_down_payment: @folder.first_down_payment&.date&.strftime("%d-%m-%Y"),
                                                                                first_finance: @folder.first_financing&.date&.strftime("%d-%m-%Y"),
                                                                                show_rate: @folder.stage.show_rate,
                                                                                interest_payments: @quotation.interest_payments,
                                                                                bank_accounts: @folder.stage.enterprise.bank_accounts,
                                                                                stp_clabe: @folder.stp_clabe,
                                                                                enterprise_name: @folder.stage.enterprise.business_name,
                                                                                project_singular: @project_singular,
                                                                                lot_singular: @lot_singular,
                                                                                price: @quotation.price,
                                                                                total_discount: @quotation.total_discount,
                                                                                valid_for_folder: true,
                                                                                down_payment_to_differ: @folder.payment_scheme.down_payment,
                                                                                with_signature: @with_signature,
                                                                                observations: @folder.stage.observations,
                                                                                down_payments: @quotation.down_payments,
                                                                                show_payment_dates: true,
                                                                                has_custom_installments: @folder.has_custom_installments?
  } %>
<% end %>

<% @folder.ruled_contract.signers.each_with_index do |signer, index| %>
  <%= render partial: "quotes/new_format/amortization_cover_for_pdf", locals: { name: @show_table ? "TABLA DE AMORTIZACIÓN" : "CARÁTULA DE AMORTIZACIÓN",
                                                                                representative_name: signer.label,
                                                                                representative_email: signer.email,
                                                                                user_name: nil,
                                                                                user_email: nil,
                                                                                related_index: index,
                                                                                clients: [],
                                                                                clients_count: 0,
                                                                                date: Time.zone.now.strftime("%Y/%m/%d"),
                                                                                folio: @folder.id,
                                                                                total_payments: @folder.payment_scheme.total_payments,
                                                                                project_name: @folder.project.name,
                                                                                stage_name: @folder.stage.full_name("/"),
                                                                                lot_name: @folder.lot.name,
                                                                                lot_area: @folder.lot.area,
                                                                                show_price: @folder.stage.show_price,
                                                                                total_with_discount: @folder.total_sale,
                                                                                initial_payment: @folder.payment_scheme.initial_payment,
                                                                                down_payment: @folder.payment_scheme.initial_payment + @folder.payment_scheme.down_payment,
                                                                                lock_payment: @folder.payment_scheme.initial_payment,
                                                                                complement_payment: @folder.payment_scheme.complement_payment,
                                                                                down_payment_finance: @folder.payment_scheme.down_payment_finance,
                                                                                down_payment_monthly_payments: @folder.first_down_payment&.total,
                                                                                down_payment_percentage: @quotation.down_payment_percentage,
                                                                                min_down_payment: @quotation.total_with_discount * @folder.stage.credit_scheme.get_min_down_payment(0.01),
                                                                                first_down_payment: @folder.first_down_payment&.date&.strftime("%d-%m-%Y"),
                                                                                first_finance: @folder.first_financing&.date&.strftime("%d-%m-%Y"),
                                                                                show_rate: @folder.stage.show_rate,
                                                                                interest_payments: @quotation.interest_payments,
                                                                                bank_accounts: @folder.stage.enterprise.bank_accounts,
                                                                                stp_clabe: @folder.stp_clabe,
                                                                                enterprise_name: @folder.stage.enterprise.business_name,
                                                                                project_singular: @project_singular,
                                                                                lot_singular: @lot_singular,
                                                                                price: @quotation.price,
                                                                                total_discount: @quotation.total_discount,
                                                                                valid_for_folder: true,
                                                                                down_payment_to_differ: @folder.payment_scheme.down_payment,
                                                                                with_signature: @with_signature,
                                                                                observations: @folder.stage.observations,
                                                                                down_payments: @quotation.down_payments,
                                                                                show_payment_dates: true,
                                                                                has_custom_installments: @folder.has_custom_installments?
  } %>
<% end  if @is_digital_signature %>
